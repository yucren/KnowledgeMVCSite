@using KnowledgeMVCSite.Models
@model List<Knowledge>
@{
    ViewBag.Title = "Index";
}

<div id="app">

    <div class="row" style="margin-left:0;margin-right:0;margin-bottom:5px; padding: 10px 0; background-color:white">
        <div class="col-md-12">
            <a href='@Url.Action("Create","Knowledge")' style="margin-right:5%" class="btn btn-primary">
                <span class="glyphicon">
                    <img src="~/Content/img/Create.png" />
                </span> 创建知识
            </a>
            <a  href='@Url.Action("Create","Knowledge")' style="margin-right:5%" class="btn btn-primary">
                <span class="glyphicon">
                    <img style="height:41px" src="~/Content/img/ask.jpg" /> 
                </span> 开始提问
            </a>

        </div>

    </div>
</div>

<div class="row">
    <div id="contentBody" class="col-md-9">

        @if (Model.Count != 0)
        {
            @Html.Partial("SearchPartial", Model)
            @*<div id="moreBtn" style="margin-top:30px">
                    <button class="btn btn-primary center-block" onclick="more()">加载更多</button>
                </div>*@
            <script>
                console.log("hellowrl")
                $(function () {
                    
                    $(window).scroll(function () {
                        console.log("helloworld")
                        var scrollTop = $(this).scrollTop();    //滚动条滚动距离
                        var scrollHeight = $(document).height();//文档内容高度
                        var windowHeight = $(this).height();  //文档可视区域高度
                        if ( 1>= (scrollHeight - scrollTop - windowHeight) <=1) {
                            
                            more();
                        }
                    });
                })
              
            </script>
        }
        else
        {

            <div id="noKnow" class="alert alert-warning">
                <a href="@Url.Action("Create","Knowledge")" class="alert-link"> 还没有人创建知识，赶紧创建吧</a>
            </div>
            
        }


    </div>



    <div class="col-md-3" style="margin-top:25px" id="catalog">
        <h3>热门标签</h3>



    </div>

</div>
<div id="loading" style="display:none">
    <img class="center-block" src="~/Content/img/loading.gif" />

</div>



@section Scripts
{
    <script>
        $(document).ready(function () {
            $('.panel-body-noborder.panel-fit').each(function (indx, item) {
                if ($(item).height() < 200) {
                    $(item).prev().find(".readAllBtn").css('display', 'none');

                }

            });
            $('#contentBody').bind('touchstart', function () {
            
                if (document.getElementById('navbar-collapse-1').classList.contains('in')) {

                    $('#navbar-collapse-1').collapse('hide');
                }

            })

            $('#contentBody').click(function () {

                if (document.getElementById('navbar-collapse-1').classList.contains('in')) {

                    $('#navbar-collapse-1').collapse('hide');
                }


            });

            function GetSlideDirection(startX, startY, endX, endY) {
                var dy = startY - endY;
                //var dx = endX - startX;

                if (dy > 0) {//向上滑动

                    if ($(this).scrollTop()===0) {
                        more();
                    }


                } else {//向下滑动


                }

            }

            //滑动处理
            var startX, startY;
            document.addEventListener('touchstart', function (ev) {
                startX = ev.touches[0].pageX;
                startY = ev.touches[0].pageY;
            }, false);



            document.addEventListener('touchend', function (ev) {
                var endX, endY;
                endX = ev.changedTouches[0].pageX;
                endY = ev.changedTouches[0].pageY;
                var direction = GetSlideDirection(startX, startY, endX, endY);
                switch (direction) {
                    case 0:
                        break;
                    case 1:
                    // 手指向上滑动
                    //alert('上');break;
                    case 2:
                    // 手指向下滑动
                    //alert('下');break;
                    default:
                }
            }, false);
        });

      


    $.get('@Url.Action("GetCatalog", "knowledge")', function (req, status, xhr) {
        var catalog = JSON.parse(req);
        catalog.forEach(function (item, index, arr) {

            $('#catalog').append('<div style="max-width:100%"><span  style="margin-bottom:5px;display:inline-block" class="label label-info"><a  href="/?catalog=' + item.CategoryId + '">' + item.Name +"</a></span></div>");
        })}

        );




        @if (ViewBag.catalog == null)
        {
            @:catalog = null;
        }
        else
        {
             @:catalog = @ViewBag.catalog;
        }

        searchValue = '@ViewBag.searchValue';
    </script>


}


